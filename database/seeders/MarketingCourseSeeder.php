<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Course;
use App\Models\Lesson;
use App\Models\LessonTool;
use App\Models\Quiz;
use App\Models\QuizQuestion;

class MarketingCourseSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // إنشاء الدورة
        $course = Course::create([
            'title' => 'دورة تعلم التسويق الشاملة',
            'description' => 'دورة متكاملة في التسويق الرقمي والتقليدي مع 20 درساً تفاعلياً وأدوات عملية واختبارات شاملة',
            'slug' => 'marketing-masterclass',
            'order_number' => 1,
            'is_active' => true,
            'total_lessons' => 20,
            'estimated_hours' => 40
        ]);

        $this->createLessonsWithTools($course);
    }

    private function createLessonsWithTools($course)
    {
        // الدرس 1: المقدمة والأساسيات
        $lesson1 = Lesson::create([
            'course_id' => $course->id,
            'lesson_number' => 1,
            'title' => 'مقدمة في التسويق وأهميته',
            'slug' => 'marketing-introduction',
            'content' => $this->getLesson1Content(),
            'learning_objectives' => [
                'فهم مفهوم التسويق وأهميته للأعمال',
                'التعرف على الفرق بين التسويق التقليدي والرقمي',
                'فهم رحلة العميل من الوعي إلى الشراء',
                'معرفة المبادئ الأساسية للتسويق الناجح'
            ],
            'key_concepts' => [
                'تعريف التسويق',
                'المزيج التسويقي (4Ps)',
                'رحلة العميل',
                'القيمة المقترحة'
            ],
            'estimated_minutes' => 45,
            'order_number' => 1,
            'has_quiz' => true,
            'has_tool' => true,
            'is_active' => true
        ]);

        // أداة الدرس 1: Business Value Calculator
        LessonTool::create([
            'lesson_id' => $lesson1->id,
            'tool_type' => 'calculator',
            'title' => 'حاسبة القيمة المقترحة',
            'description' => 'أداة لمساعدتك في حساب وتقييم القيمة التي يقدمها منتجك أو خدمتك للعملاء',
            'tool_config' => [
                'fields' => [
                    ['name' => 'product_price', 'label' => 'سعر المنتج', 'type' => 'number'],
                    ['name' => 'customer_problem', 'label' => 'المشكلة التي يحلها', 'type' => 'text'],
                    ['name' => 'time_saved_hours', 'label' => 'الوقت الموفر (ساعات)', 'type' => 'number'],
                    ['name' => 'money_saved', 'label' => 'المال الموفر', 'type' => 'number'],
                    ['name' => 'alternative_cost', 'label' => 'تكلفة البديل', 'type' => 'number']
                ],
                'calculations' => [
                    'roi' => '((money_saved + (time_saved_hours * 50)) - product_price) / product_price * 100',
                    'value_score' => '(money_saved + alternative_cost - product_price) / product_price'
                ]
            ],
            'example_data' => [
                'product_price' => 500,
                'time_saved_hours' => 10,
                'money_saved' => 2000,
                'alternative_cost' => 1500
            ],
            'component_name' => 'ValueCalculator',
            'is_active' => true
        ]);

        // اختبار الدرس 1
        $quiz1 = Quiz::create([
            'lesson_id' => $lesson1->id,
            'title' => 'اختبار: المقدمة في التسويق',
            'description' => 'اختبر فهمك للمفاهيم الأساسية في التسويق',
            'quiz_type' => 'lesson',
            'passing_score' => 70,
            'time_limit_minutes' => 10,
            'show_correct_answers' => true,
            'allow_retake' => true,
            'is_active' => true
        ]);

        $this->createQuizQuestions($quiz1, [
            [
                'question' => 'ما هو التعريف الأصح للتسويق؟',
                'type' => 'multiple_choice',
                'options' => [
                    'بيع المنتجات بأي طريقة ممكنة',
                    'فهم احتياجات العملاء وتلبيتها بطريقة مربحة',
                    'الإعلان عن المنتجات فقط',
                    'خفض الأسعار لزيادة المبيعات'
                ],
                'correct' => [1],
                'explanation' => 'التسويق هو فهم احتياجات العملاء وتلبيتها بطريقة تحقق قيمة للطرفين - العميل والشركة'
            ],
            [
                'question' => 'ما هي عناصر المزيج التسويقي (4Ps)؟',
                'type' => 'multiple_select',
                'options' => [
                    'المنتج (Product)',
                    'السعر (Price)',
                    'المكان/التوزيع (Place)',
                    'الترويج (Promotion)',
                    'العمولة (Commission)',
                    'الربح (Profit)'
                ],
                'correct' => [0, 1, 2, 3],
                'explanation' => 'المزيج التسويقي يتكون من 4 عناصر: المنتج، السعر، المكان، والترويج'
            ],
            [
                'question' => 'التسويق الرقمي أفضل من التسويق التقليدي في جميع الحالات',
                'type' => 'true_false',
                'options' => ['صحيح', 'خطأ'],
                'correct' => [1],
                'explanation' => 'خطأ - كلا النوعين لهما مميزات، والاختيار يعتمد على نوع المنتج، الجمهور المستهدف، والميزانية'
            ],
            [
                'question' => 'ما هي المرحلة الأولى في رحلة العميل؟',
                'type' => 'multiple_choice',
                'options' => [
                    'الشراء',
                    'الوعي (Awareness)',
                    'التقييم',
                    'الولاء'
                ],
                'correct' => [1],
                'explanation' => 'رحلة العميل تبدأ بمرحلة الوعي حيث يدرك العميل وجود منتجك أو علامتك التجارية'
            ],
            [
                'question' => 'القيمة المقترحة (Value Proposition) هي:',
                'type' => 'multiple_choice',
                'options' => [
                    'سعر المنتج فقط',
                    'الفوائد الفريدة التي يقدمها منتجك للعميل',
                    'الخصومات والعروض',
                    'مدة الضمان'
                ],
                'correct' => [1],
                'explanation' => 'القيمة المقترحة هي مجموعة الفوائد والحلول الفريدة التي يقدمها منتجك لحل مشكلة العميل'
            ]
        ]);

        // الدرس 2: فهم السوق
        $lesson2 = Lesson::create([
            'course_id' => $course->id,
            'lesson_number' => 2,
            'title' => 'افهم السوق قبل أن تبدأ',
            'slug' => 'understand-your-market',
            'content' => $this->getLesson2Content(),
            'learning_objectives' => [
                'كيفية إجراء بحث سوقي فعال',
                'تحديد حجم السوق والفرص المتاحة',
                'فهم اتجاهات السوق والتغيرات',
                'تقييم المنافسة في السوق'
            ],
            'key_concepts' => [
                'البحث السوقي',
                'تقسيم السوق (Segmentation)',
                'حجم السوق الفعلي والمحتمل',
                'تحليل المنافسين'
            ],
            'estimated_minutes' => 50,
            'order_number' => 2,
            'has_quiz' => true,
            'has_tool' => true,
            'is_active' => true
        ]);

        // أداة الدرس 2: Market Size Calculator
        LessonTool::create([
            'lesson_id' => $lesson2->id,
            'tool_type' => 'calculator',
            'title' => 'حاسبة حجم السوق',
            'description' => 'احسب حجم السوق المستهدف والإيرادات المتوقعة',
            'tool_config' => [
                'fields' => [
                    ['name' => 'total_population', 'label' => 'إجمالي السكان المستهدفين', 'type' => 'number'],
                    ['name' => 'target_percentage', 'label' => 'نسبة الجمهور المستهدف (%)', 'type' => 'number'],
                    ['name' => 'conversion_rate', 'label' => 'معدل التحويل المتوقع (%)', 'type' => 'number'],
                    ['name' => 'average_sale', 'label' => 'متوسط قيمة البيع', 'type' => 'number'],
                    ['name' => 'market_share_goal', 'label' => 'الحصة السوقية المستهدفة (%)', 'type' => 'number']
                ],
                'calculations' => [
                    'tam' => 'total_population * average_sale',
                    'sam' => 'total_population * (target_percentage / 100) * average_sale',
                    'som' => 'total_population * (target_percentage / 100) * (conversion_rate / 100) * (market_share_goal / 100) * average_sale'
                ]
            ],
            'example_data' => [
                'total_population' => 1000000,
                'target_percentage' => 20,
                'conversion_rate' => 5,
                'average_sale' => 500,
                'market_share_goal' => 10
            ],
            'component_name' => 'MarketSizeCalculator',
            'is_active' => true
        ]);

        // اختبار الدرس 2
        $quiz2 = Quiz::create([
            'lesson_id' => $lesson2->id,
            'title' => 'اختبار: فهم السوق',
            'quiz_type' => 'lesson',
            'passing_score' => 70,
            'time_limit_minutes' => 10,
            'is_active' => true
        ]);

        $this->createQuizQuestions($quiz2, [
            [
                'question' => 'ما هو TAM (Total Addressable Market)؟',
                'type' => 'multiple_choice',
                'options' => [
                    'السوق الفعلي الذي وصلت إليه',
                    'إجمالي حجم السوق المتاح لمنتجك',
                    'العملاء الحاليين فقط',
                    'المنافسين في السوق'
                ],
                'correct' => [1],
                'explanation' => 'TAM هو إجمالي الطلب المحتمل على منتجك في السوق بأكمله'
            ],
            [
                'question' => 'أي من التالية يعتبر مصدراً موثوقاً للبحث السوقي؟',
                'type' => 'multiple_select',
                'options' => [
                    'البيانات الحكومية والإحصاءات الرسمية',
                    'استطلاعات رأي العملاء المباشرة',
                    'تقارير الصناعة المتخصصة',
                    'الآراء الشخصية فقط'
                ],
                'correct' => [0, 1, 2],
                'explanation' => 'البحث السوقي الفعال يعتمد على مصادر متعددة وموثوقة من البيانات'
            ]
        ]);

        // الدرس 3: تحديد العميل المثالي
        $lesson3 = Lesson::create([
            'course_id' => $course->id,
            'lesson_number' => 3,
            'title' => 'اعرف من هو عميلك فعلاً',
            'slug' => 'ideal-customer-profile',
            'content' => $this->getLesson3Content(),
            'learning_objectives' => [
                'بناء شخصية العميل المثالي (Buyer Persona)',
                'فهم احتياجات ورغبات العملاء',
                'تحديد نقاط الألم (Pain Points)',
                'معرفة قنوات التواصل المفضلة للعملاء'
            ],
            'key_concepts' => [
                'شخصية المشتري (Buyer Persona)',
                'نقاط الألم (Pain Points)',
                'الدوافع الشرائية',
                'رحلة العميل'
            ],
            'estimated_minutes' => 55,
            'order_number' => 3,
            'has_quiz' => true,
            'has_tool' => true
        ]);

        // أداة الدرس 3: Persona Builder
        LessonTool::create([
            'lesson_id' => $lesson3->id,
            'tool_type' => 'template',
            'title' => 'منشئ شخصية العميل المثالي',
            'description' => 'أداة تفاعلية لبناء شخصية عميلك المثالي بالتفصيل',
            'tool_config' => [
                'fields' => [
                    ['name' => 'name', 'label' => 'الاسم (مثال)', 'type' => 'text', 'section' => 'demographics'],
                    ['name' => 'age', 'label' => 'العمر', 'type' => 'number', 'section' => 'demographics'],
                    ['name' => 'gender', 'label' => 'الجنس', 'type' => 'select', 'options' => ['ذكر', 'أنثى'], 'section' => 'demographics'],
                    ['name' => 'job_title', 'label' => 'المسمى الوظيفي', 'type' => 'text', 'section' => 'demographics'],
                    ['name' => 'income_level', 'label' => 'مستوى الدخل', 'type' => 'select', 'options' => ['منخفض', 'متوسط', 'عالي', 'مرتفع جداً'], 'section' => 'demographics'],
                    ['name' => 'location', 'label' => 'الموقع الجغرافي', 'type' => 'text', 'section' => 'demographics'],

                    ['name' => 'goals', 'label' => 'أهدافه ورغباته', 'type' => 'textarea', 'section' => 'psychographics'],
                    ['name' => 'pain_points', 'label' => 'المشاكل التي يواجهها', 'type' => 'textarea', 'section' => 'psychographics'],
                    ['name' => 'values', 'label' => 'القيم المهمة له', 'type' => 'textarea', 'section' => 'psychographics'],
                    ['name' => 'interests', 'label' => 'الاهتمامات والهوايات', 'type' => 'textarea', 'section' => 'psychographics'],

                    ['name' => 'preferred_channels', 'label' => 'قنوات التواصل المفضلة', 'type' => 'multiselect', 'options' => ['Facebook', 'Instagram', 'Twitter', 'LinkedIn', 'WhatsApp', 'Email', 'المكالمات'], 'section' => 'behavior'],
                    ['name' => 'buying_triggers', 'label' => 'محفزات الشراء', 'type' => 'textarea', 'section' => 'behavior'],
                    ['name' => 'objections', 'label' => 'الاعتراضات المحتملة', 'type' => 'textarea', 'section' => 'behavior']
                ]
            ],
            'example_data' => [
                'name' => 'سارة محمد',
                'age' => 32,
                'job_title' => 'مديرة تسويق',
                'goals' => 'تحسين أداء الحملات التسويقية، تعلم مهارات جديدة',
                'pain_points' => 'ضيق الوقت، ميزانية محدودة، صعوبة قياس النتائج'
            ],
            'component_name' => 'PersonaBuilder'
        ]);

        $quiz3 = Quiz::create([
            'lesson_id' => $lesson3->id,
            'title' => 'اختبار: العميل المثالي',
            'quiz_type' => 'lesson',
            'passing_score' => 70,
            'time_limit_minutes' => 10
        ]);

        $this->createQuizQuestions($quiz3, [
            [
                'question' => 'شخصية المشتري (Buyer Persona) هي:',
                'type' => 'multiple_choice',
                'options' => [
                    'قائمة بأسماء العملاء الحاليين',
                    'تمثيل شبه خيالي للعميل المثالي مبني على بيانات حقيقية',
                    'صورة للعميل فقط',
                    'عدد العملاء المستهدفين'
                ],
                'correct' => [1],
                'explanation' => 'Buyer Persona هي شخصية شبه خيالية تمثل عميلك المثالي مبنية على أبحاث وبيانات حقيقية'
            ],
            [
                'question' => 'ما هي "نقاط الألم" (Pain Points)؟',
                'type' => 'multiple_choice',
                'options' => [
                    'المشاكل والتحديات التي يواجهها العميل',
                    'السعر المرتفع للمنتج',
                    'المنافسون في السوق',
                    'طرق الدفع المتاحة'
                ],
                'correct' => [0],
                'explanation' => 'نقاط الألم هي المشاكل والتحديات والإحباطات التي يواجهها عميلك والتي يسعى منتجك لحلها'
            ]
        ]);

        // الدرس 4 إلى 20: سأقوم بإنشائهم بنفس الطريقة...
        // لاختصار الوقت، سأضع نسخة مختصرة للدروس المتبقية

        $lessonsData = [
            [
                'number' => 4,
                'title' => 'رحلة البحث عن مواصفات العميل المثالي',
                'content' => 'محتوى الدرس 4...',
                'tool' => ['type' => 'planner', 'title' => 'مخطط رحلة العميل', 'component' => 'CustomerJourneyMapper']
            ],
            [
                'number' => 5,
                'title' => 'صوتك في السوق - Brand Voice',
                'content' => 'محتوى الدرس 5...',
                'tool' => ['type' => 'analyzer', 'title' => 'محلل الهوية الصوتية', 'component' => 'BrandVoiceAnalyzer']
            ],
            [
                'number' => 6,
                'title' => 'كتابة المحتوى التسويقي',
                'content' => 'محتوى الدرس 6...',
                'tool' => ['type' => 'template', 'title' => 'قوالب النصوص التسويقية', 'component' => 'CopywritingTemplates']
            ],
            [
                'number' => 7,
                'title' => 'القنوات التسويقية',
                'content' => 'محتوى الدرس 7...',
                'tool' => ['type' => 'calculator', 'title' => 'مقارنة القنوات التسويقية', 'component' => 'ChannelComparison']
            ],
            [
                'number' => 8,
                'title' => 'خطة المحتوى التسويقي',
                'content' => 'محتوى الدرس 8...',
                'tool' => ['type' => 'planner', 'title' => 'مخطط التقويم التسويقي', 'component' => 'ContentCalendar']
            ],
            [
                'number' => 9,
                'title' => 'بناء الهوية التسويقية',
                'content' => 'محتوى الدرس 9...',
                'tool' => ['type' => 'template', 'title' => 'دليل الهوية التسويقية', 'component' => 'BrandIdentityGuide']
            ],
            [
                'number' => 10,
                'title' => 'كيف تبني محتوى يبيع',
                'content' => 'محتوى الدرس 10...',
                'tool' => ['type' => 'analyzer', 'title' => 'محلل فعالية المحتوى', 'component' => 'ContentEffectivenessAnalyzer']
            ],
            [
                'number' => 11,
                'title' => 'الإعلان الممول',
                'content' => 'محتوى الدرس 11...',
                'tool' => ['type' => 'calculator', 'title' => 'حاسبة ميزانية الإعلانات', 'component' => 'AdBudgetCalculator']
            ],
            [
                'number' => 12,
                'title' => 'استراتيجيات زيادة المبيعات',
                'content' => 'محتوى الدرس 12...',
                'tool' => ['type' => 'calculator', 'title' => 'حاسبة معدل التحويل', 'component' => 'ConversionRateCalculator']
            ],
            [
                'number' => 13,
                'title' => 'قياس النتائج التسويقية والتحليل',
                'content' => 'محتوى الدرس 13...',
                'tool' => ['type' => 'calculator', 'title' => 'حاسبة ROI التسويقي', 'component' => 'ROICalculator']
            ],
            [
                'number' => 14,
                'title' => 'بناء علاقات العملاء طويلة الأمد',
                'content' => 'محتوى الدرس 14...',
                'tool' => ['type' => 'calculator', 'title' => 'حاسبة القيمة الدائمة للعميل', 'component' => 'CLVCalculator']
            ],
            [
                'number' => 15,
                'title' => 'التسويق بالذكاء الاصطناعي',
                'content' => 'محتوى الدرس 15...',
                'tool' => ['type' => 'generator', 'title' => 'مولد الأفكار التسويقية بالذكاء الاصطناعي', 'component' => 'AIIdeaGenerator']
            ],
            [
                'number' => 16,
                'title' => 'إدارة الأزمات التسويقية',
                'content' => 'محتوى الدرس 16...',
                'tool' => ['type' => 'template', 'title' => 'خطة إدارة الأزمات', 'component' => 'CrisisManagementPlan']
            ],
            [
                'number' => 17,
                'title' => 'التسويق للشركات B2B',
                'content' => 'محتوى الدرس 17...',
                'tool' => ['type' => 'template', 'title' => 'نموذج العرض التجاري', 'component' => 'B2BProposalTemplate']
            ],
            [
                'number' => 18,
                'title' => 'تحسين محركات البحث SEO',
                'content' => 'محتوى الدرس 18...',
                'tool' => ['type' => 'analyzer', 'title' => 'محلل الكلمات المفتاحية', 'component' => 'KeywordAnalyzer']
            ],
            [
                'number' => 19,
                'title' => 'التسويق التأثيري',
                'content' => 'محتوى الدرس 19...',
                'tool' => ['type' => 'calculator', 'title' => 'حاسبة ROI التسويق التأثيري', 'component' => 'InfluencerROICalculator']
            ],
            [
                'number' => 20,
                'title' => 'ورشة عمل تطبيقية',
                'content' => 'محتوى الدرس 20...',
                'tool' => ['type' => 'planner', 'title' => 'مخطط الخطة التسويقية الشاملة', 'component' => 'FullMarketingPlanBuilder']
            ]
        ];

        foreach ($lessonsData as $data) {
            $lesson = Lesson::create([
                'course_id' => $course->id,
                'lesson_number' => $data['number'],
                'title' => $data['title'],
                'slug' => 'lesson-' . $data['number'],
                'content' => $data['content'],
                'learning_objectives' => [],
                'key_concepts' => [],
                'estimated_minutes' => 50,
                'order_number' => $data['number'],
                'has_quiz' => true,
                'has_tool' => true
            ]);

            if (isset($data['tool'])) {
                LessonTool::create([
                    'lesson_id' => $lesson->id,
                    'tool_type' => $data['tool']['type'],
                    'title' => $data['tool']['title'],
                    'tool_config' => ['fields' => []],
                    'component_name' => $data['tool']['component']
                ]);
            }

            $quiz = Quiz::create([
                'lesson_id' => $lesson->id,
                'title' => 'اختبار: ' . $data['title'],
                'quiz_type' => 'lesson',
                'passing_score' => 70,
                'time_limit_minutes' => 10
            ]);

            // إضافة أسئلة نموذجية لكل اختبار
            $this->createQuizQuestions($quiz, [
                [
                    'question' => 'سؤال نموذجي للدرس ' . $data['number'],
                    'type' => 'multiple_choice',
                    'options' => ['خيار 1', 'خيار 2', 'خيار 3', 'خيار 4'],
                    'correct' => [1],
                    'explanation' => 'شرح الإجابة الصحيحة'
                ]
            ]);
        }

        // إنشاء الاختبار النهائي
        $this->createFinalQuiz($course);
    }

    private function createFinalQuiz($course)
    {
        $finalQuiz = Quiz::create([
            'course_id' => $course->id,
            'title' => 'الاختبار النهائي الشامل - دورة التسويق',
            'description' => 'اختبار شامل يغطي جميع محاور الدورة',
            'quiz_type' => 'final',
            'passing_score' => 75,
            'time_limit_minutes' => 60,
            'show_correct_answers' => true,
            'allow_retake' => true
        ]);

        // 50 سؤال شامل يغطي جميع الدروس
        $finalQuestions = [];

        // أسئلة من الدرس 1-5
        $finalQuestions = array_merge($finalQuestions, [
            [
                'question' => 'ما هو الهدف الأساسي من التسويق؟',
                'type' => 'multiple_choice',
                'options' => [
                    'زيادة المبيعات فقط',
                    'بناء علاقات طويلة الأمد مع العملاء وتحقيق قيمة متبادلة',
                    'خفض التكاليف',
                    'زيادة عدد الموظفين'
                ],
                'correct' => [1],
                'explanation' => 'التسويق يهدف إلى بناء علاقات مستدامة وتحقيق قيمة للعميل والشركة معاً'
            ],
            [
                'question' => 'أي من التالية تعتبر من مكونات القيمة المقترحة الفعالة؟',
                'type' => 'multiple_select',
                'options' => [
                    'حل مشكلة حقيقية للعميل',
                    'ميزة تنافسية واضحة',
                    'فوائد قابلة للقياس',
                    'سعر منخفض فقط'
                ],
                'correct' => [0, 1, 2],
                'explanation' => 'القيمة المقترحة القوية تجمع بين حل المشكلة، التميز، والفوائد القابلة للقياس'
            ]
        ]);

        // أسئلة إضافية تغطي باقي الدروس (6-20)
        for ($i = 6; $i <= 20; $i++) {
            $finalQuestions[] = [
                'question' => "سؤال شامل من الدرس {$i}",
                'type' => 'multiple_choice',
                'options' => ['خيار أ', 'خيار ب', 'خيار ج', 'خيار د'],
                'correct' => [rand(0, 3)],
                'explanation' => "شرح الإجابة للدرس {$i}"
            ];
        }

        // أسئلة تحليلية متقدمة
        $finalQuestions = array_merge($finalQuestions, [
            [
                'question' => 'في حالة انخفاض معدل التحويل رغم زيادة الزيارات، ما هو السبب الأكثر احتمالاً؟',
                'type' => 'multiple_choice',
                'options' => [
                    'مشكلة في الاستهداف أو رسالة غير مناسبة للجمهور',
                    'السعر مرتفع جداً دائماً',
                    'المنافسون أفضل في جميع الحالات',
                    'الموقع الإلكتروني بطيء'
                ],
                'correct' => [0],
                'explanation' => 'عندما تزيد الزيارات لكن التحويل ينخفض، غالباً المشكلة في جودة الزيارات أو مدى ملاءمة الرسالة للجمهور'
            ]
        ]);

        $this->createQuizQuestions($finalQuiz, $finalQuestions);
    }

    private function createQuizQuestions($quiz, $questionsData)
    {
        foreach ($questionsData as $index => $q) {
            QuizQuestion::create([
                'quiz_id' => $quiz->id,
                'question_text' => $q['question'],
                'question_type' => $q['type'],
                'options' => $q['options'],
                'correct_answers' => $q['correct'],
                'explanation' => $q['explanation'] ?? '',
                'points' => 1,
                'order_number' => $index + 1
            ]);
        }
    }

    // محتوى الدروس المفصل
    private function getLesson1Content()
    {
        return <<<CONTENT
# مقدمة في التسويق وأهميته

## ما هو التسويق؟

التسويق هو أكثر من مجرد الإعلان أو البيع - إنه عملية شاملة لفهم احتياجات العملاء وتلبيتها بطريقة تحقق قيمة لكل من العميل والشركة.

### تعريف التسويق الحديث

> "التسويق هو فن وعلم خلق القيمة للعملاء وبناء علاقات قوية معهم لتحقيق منافع متبادلة"

## لماذا التسويق مهم؟

1. **فهم السوق**: يساعدك على فهم ماذا يريد عملاؤك حقاً
2. **التميز**: يميزك عن المنافسين في سوق مزدحم
3. **النمو المستدام**: يضع أساساً قوياً لنمو طويل الأمد
4. **بناء العلامة التجارية**: يخلق قيمة معنوية لشركتك

## الفرق بين التسويق التقليدي والرقمي

### التسويق التقليدي
- الإعلانات التلفزيونية والإذاعية
- اللوحات الإعلانية
- المطبوعات (جرائد، مجلات)
- البريد المباشر

**المميزات:**
- وصول واسع للجمهور
- مصداقية عالية
- تأثير بصري قوي

**العيوب:**
- تكلفة عالية
- صعوبة قياس النتائج
- محدودية التفاعل

### التسويق الرقمي
- وسائل التواصل الاجتماعي
- محركات البحث (SEO/SEM)
- البريد الإلكتروني
- المحتوى الرقمي

**المميزات:**
- استهداف دقيق
- قياس فوري للنتائج
- تكلفة أقل
- تفاعل مباشر مع العملاء

**العيوب:**
- منافسة شديدة
- تطور سريع يتطلب تعلماً مستمراً
- إمكانية التشويش والإزعاج

## المزيج التسويقي (4Ps)

### 1. المنتج (Product)
ما تقدمه للعميل - السلعة أو الخدمة وجودتها ومميزاتها

### 2. السعر (Price)
كم يدفع العميل - استراتيجية التسعير والخصومات

### 3. المكان (Place)
أين يحصل العميل على منتجك - قنوات التوزيع

### 4. الترويج (Promotion)
كيف يعرف العميل عن منتجك - الإعلان والتواصل

## رحلة العميل

### المراحل الخمس:

1. **الوعي (Awareness)**
   - العميل يدرك وجود مشكلة أو حاجة
   - يبدأ البحث عن حلول محتملة

2. **الاهتمام (Interest)**
   - العميل يتعرف على منتجك
   - يبدأ في جمع المعلومات

3. **التقييم (Consideration)**
   - مقارنة منتجك مع البدائل
   - تقييم الفوائد والتكاليف

4. **الشراء (Purchase)**
   - اتخاذ قرار الشراء
   - إتمام العملية

5. **الولاء (Loyalty)**
   - تجربة ما بعد الشراء
   - احتمالية الشراء المتكرر والتوصية

## القيمة المقترحة (Value Proposition)

### ما هي القيمة المقترحة؟
بيان واضح يشرح:
- **المشكلة** التي يحلها منتجك
- **الفوائد** المحددة التي تقدمها
- **لماذا أنت** أفضل من البدائل

### عناصر القيمة المقترحة القوية:
1. واضحة وسهلة الفهم
2. تركز على فوائد محددة وقابلة للقياس
3. تميزك عن المنافسين
4. تخاطب نقاط الألم الحقيقية للعميل

## التطبيق العملي

استخدم **حاسبة القيمة المقترحة** أسفل هذا الدرس لتقييم القيمة التي يقدمها منتجك أو خدمتك.

## الخلاصة

التسويق الفعال يبدأ بفهم عميق للعميل واحتياجاته، ويستمر ببناء علاقة قوية معه. في الدروس القادمة، سنتعمق في كل جانب من جوانب التسويق الناجح.

---

### الخطوة التالية
بعد إنهاء هذا الدرس، قم بحل الاختبار للتأكد من فهمك للمفاهيم الأساسية، ثم انتقل للدرس التالي: "افهم السوق قبل أن تبدأ".
CONTENT;
    }

    private function getLesson2Content()
    {
        return <<<CONTENT
# افهم السوق قبل أن تبدأ

## لماذا البحث السوقي مهم؟

قبل أن تطلق منتجك أو خدمتك، يجب أن تفهم بيئة السوق التي ستعمل فيها. البحث السوقي يساعدك على:

- تجنب إطلاق منتج لا يريده أحد
- تحديد الفرص المتاحة
- فهم احتياجات العملاء الحقيقية
- تحديد المنافسين وفهم نقاط قوتهم وضعفهم

## أنواع البحث السوقي

### 1. البحث الأولي (Primary Research)
بيانات تجمعها أنت مباشرة من مصادرها:
- **الاستبيانات**: أسئلة موجهة لجمهورك المستهدف
- **المقابلات**: حوارات معمقة مع عملاء محتملين
- **مجموعات النقاش**: جلسات جماعية لفهم الآراء والمشاعر
- **الملاحظة**: مراقبة سلوك العملاء في بيئتهم الطبيعية

### 2. البحث الثانوي (Secondary Research)
بيانات موجودة مسبقاً من مصادر خارجية:
- تقارير الصناعة
- إحصاءات حكومية
- دراسات أكاديمية
- تقارير المنافسين

## فهم حجم السوق

### TAM, SAM, SOM - ما معناها؟

#### TAM (Total Addressable Market)
**السوق الكلي المتاح**: إجمالي الطلب المحتمل على منتجك في السوق بأكمله

**مثال**: إذا كنت تبيع برمجيات محاسبة، TAM = جميع الشركات التي تحتاج برمجيات محاسبة × متوسط سعر البرمجية

#### SAM (Serviceable Available Market)
**السوق القابل للخدمة**: الجزء من TAM الذي يمكنك خدمته بناءً على نموذج عملك وقدراتك

**مثال**: إذا كانت برمجيتك باللغة العربية وتستهدف السعودية فقط، SAM = الشركات السعودية فقط

#### SOM (Serviceable Obtainable Market)
**السوق القابل للتحقيق**: الجزء من SAM الذي يمكنك الحصول عليه فعلياً في السنوات القادمة

**مثال**: حصتك السوقية المتوقعة = 5% من SAM في السنة الأولى

## تحليل المنافسين

### كيف تحلل منافسيك؟

#### 1. حدد منافسيك
- **المنافسون المباشرون**: يقدمون نفس المنتج/الخدمة
- **المنافسون غير المباشرون**: يحلون نفس المشكلة بطريقة مختلفة
- **المنافسون البديلون**: خيارات بديلة قد يلجأ لها العميل

#### 2. قيّم عروضهم
- ما هي منتجاتهم/خدماتهم؟
- ما هي أسعارهم؟
- كيف يسوقون أنفسهم؟
- من هو جمهورهم المستهدف؟

#### 3. نقاط القوة والضعف
استخدم تحليل SWOT لكل منافس:
- **Strengths**: ما الذي يجيدونه؟
- **Weaknesses**: أين يضعفون؟
- **Opportunities**: ما الفرص المتاحة لهم؟
- **Threats**: ما التهديدات التي يواجهونها؟

## اتجاهات السوق

### كيف تتعرف على اتجاهات السوق؟

1. **Google Trends**: تتبع اهتمامات البحث عبر الزمن
2. **تقارير الصناعة**: مثل تقارير Gartner أو Statista
3. **وسائل التواصل**: ما الذي يتحدث عنه الناس؟
4. **المؤتمرات والفعاليات**: آخر التطورات في مجالك

### أنواع الاتجاهات:

- **اتجاهات تقنية**: تكنولوجيا جديدة تؤثر على المجال
- **اتجاهات سلوكية**: تغيرات في سلوك وتوقعات المستهلكين
- **اتجاهات اقتصادية**: عوامل اقتصادية تؤثر على القوة الشرائية
- **اتجاهات تنظيمية**: قوانين وتشريعات جديدة

## تقسيم السوق (Market Segmentation)

### لماذا تقسيم السوق؟

السوق ليس كتلة واحدة - هناك شرائح مختلفة لها احتياجات وخصائص مختلفة.

### طرق التقسيم:

#### 1. التقسيم الديموغرافي
- العمر
- الجنس
- الدخل
- التعليم
- المهنة

#### 2. التقسيم الجغرافي
- الدولة/المدينة
- المناخ
- الحضر vs الريف
- الكثافة السكانية

#### 3. التقسيم النفسي
- نمط الحياة
- القيم والمعتقدات
- الشخصية
- الاهتمامات

#### 4. التقسيم السلوكي
- معدل الاستخدام
- الولاء للعلامة التجارية
- المناسبات الشرائية
- الفوائد المطلوبة

## البيانات الأساسية للبحث السوقي

عند إجراء بحث سوقي، اجمع:

### عن السوق:
- حجم السوق (بالقيمة والعدد)
- معدل النمو السنوي
- حواجز الدخول
- الموسمية

### عن العملاء:
- من هم؟
- ما حجم احتياجهم؟
- ما قدرتهم الشرائية؟
- أين يتواجدون؟

### عن المنافسين:
- من هم الرواد؟
- ما حصتهم السوقية؟
- ما استراتيجياتهم؟
- نقاط قوتهم وضعفهم؟

## أدوات البحث السوقي

### أدوات مجانية:
- Google Trends
- Google Consumer Surveys
- Facebook Audience Insights
- LinkedIn Research
- SurveyMonkey (نسخة مجانية)

### أدوات مدفوعة:
- SEMrush / Ahrefs (تحليل المنافسين)
- Statista (إحصاءات وتقارير)
- Nielsen (أبحاث سوق متقدمة)
- Qualtrics (استبيانات احترافية)

## التطبيق العملي

استخدم **حاسبة حجم السوق** أدناه لحساب TAM, SAM, SOM لمشروعك.

## الخلاصة

البحث السوقي ليس رفاهية - إنه ضرورة. استثمر الوقت في فهم سوقك قبل أن تستثمر المال في المنتج والتسويق.

> "أعطني ست ساعات لقطع شجرة، وسأقضي أول أربع ساعات في شحذ الفأس" - أبراهام لينكولن

الفهم العميق للسوق هو "شحذ فأسك" قبل دخول المعركة التنافسية.

---

### الخطوة التالية
بعد فهم السوق، حان الوقت لفهم عميلك المثالي بالتفصيل في الدرس القادم.
CONTENT;
    }

    private function getLesson3Content()
    {
        return <<<CONTENT
# اعرف من هو عميلك فعلاً

## ما هي شخصية المشتري (Buyer Persona)؟

شخصية المشتري هي تمثيل شبه خيالي لعميلك المثالي، مبني على:
- أبحاث حقيقية
- بيانات من عملاء حاليين
- تحليل سلوكي
- مقابلات ومجموعات تركيز

### لماذا تحتاج Buyer Persona؟

بدون فهم واضح لمن تستهدف:
- ستضيع ميزانيتك في إعلانات تصل للأشخاص الخطأ
- ستكتب محتوى لا يلمس احتياجات حقيقية
- ستقدم منتجاً لا يحل المشكلة الصحيحة
- ستفشل في بناء اتصال عاطفي مع العملاء

## بناء Buyer Persona خطوة بخطوة

### 1. المعلومات الديموغرافية

#### الأساسيات:
- **الاسم**: (مثال وصفي مثل "سارة المديرة النشيطة")
- **العمر**: الفئة العمرية الأكثر شيوعاً
- **الجنس**: إذا كان ذا صلة بمنتجك
- **الموقع**: أين يعيش عميلك المثالي؟
- **الحالة الاجتماعية**: متزوج/أعزب، لديه أطفال؟

#### المعلومات المهنية:
- **المسمى الوظيفي**: ما وظيفته؟
- **الشركة**: حجم ونوع الشركة التي يعمل بها
- **مستوى الخبرة**: مبتدئ/متوسط/خبير
- **الدخل**: النطاق الشهري أو السنوي

### 2. الخصائص النفسية (Psychographics)

#### الأهداف والرغبات:
- ما الذي يسعى لتحقيقه؟
- ما طموحاته المهنية والشخصية؟
- كيف يعرّف النجاح؟

**مثال**: "سارة تريد ترقية لمنصب مدير أول خلال عامين، وتسعى لبناء سمعة كخبيرة في التسويق الرقمي"

#### القيم والمعتقدات:
- ما المهم له في الحياة؟
- ما مبادئه في اتخاذ القرارات؟
- ما العلامات التجارية التي يثق بها ولماذا؟

**مثال**: "تقدر سارة الجودة على السعر، وتؤمن بالتعلم المستمر، وتحترم العلامات التجارية الشفافة"

#### نمط الحياة:
- كيف يقضي وقته؟
- ما هواياته واهتماماته؟
- ماذا يقرأ/يشاهد/يستمع إليه؟

### 3. نقاط الألم (Pain Points)

هذا هو الجزء الأهم! ما المشاكل والتحديات التي يواجهها؟

#### أنواع نقاط الألم:

**ألم وظيفي**: مشكلة في أداء مهمة
- "استغرق 10 ساعات أسبوعياً في إنشاء تقارير يدوية"

**ألم مالي**: مشكلة تكلفة
- "أدفع الكثير مقابل أدوات لا أستخدم معظم مميزاتها"

**ألم عملي**: صعوبة في الاستخدام
- "البرامج الحالية معقدة جداً وتحتاج تدريباً طويلاً"

**ألم دعم**: عدم وجود مساعدة كافية
- "عندما تواجهني مشكلة، لا أجد من يساعدني بسرعة"

### 4. السلوك الشرائي

#### رحلة الشراء:
- كيف يبحث عن الحلول؟ (Google؟ أصدقاء؟ وسائل تواصل؟)
- ما المعايير التي يقيّم بها الخيارات؟
- من يؤثر على قراره؟
- كم يستغرق من الوعي حتى الشراء؟

#### محفزات الشراء:
ما الذي يدفعه لاتخاذ القرار الآن؟
- موسم معين؟
- عرض خاص؟
- ضغط من مديره؟
- مشكلة عاجلة؟

#### الاعتراضات المحتملة:
ما الذي قد يمنعه من الشراء؟
- "السعر مرتفع"
- "لست متأكداً أنه سيعمل"
- "يحتاج وقت تطبيق طويل"
- "لا أثق في العلامة التجارية"

### 5. قنوات التواصل المفضلة

أين يقضي عميلك وقته؟

#### على الإنترنت:
- Facebook, Instagram, LinkedIn, Twitter, TikTok؟
- المدونات والمواقع الإخبارية؟
- المنتديات والمجتمعات؟
- YouTube أو Podcast؟

#### خارج الإنترنت:
- الصحف والمجلات؟
- الفعاليات والمؤتمرات؟
- التلفزيون والراديو؟
- المتاجر الفعلية؟

## مثال كامل: Buyer Persona

### "أحمد - مدير الشركة الصغيرة المشغول"

#### الديموغرافيا:
- العمر: 35-45
- الجنس: ذكر
- الموقع: الرياض، السعودية
- الحالة: متزوج، لديه 2-3 أطفال
- الوظيفة: مالك/مدير شركة صغيرة-متوسطة (10-50 موظف)
- الدخل: 25,000 - 50,000 ريال شهرياً

#### الخصائص النفسية:
**الأهداف:**
- تنمية الشركة بنسبة 30% سنوياً
- بناء علامة تجارية قوية في السوق المحلي
- تحقيق التوازن بين العمل والحياة الشخصية

**القيم:**
- الجودة والاحترافية
- الوفاء بالوعود
- العلاقات طويلة الأمد

**نمط الحياة:**
- يعمل 10-12 ساعة يومياً
- يحضر فعاليات الأعمال والشبكات المهنية
- يقرأ مقالات عن ريادة الأعمال والتسويق

#### نقاط الألم:
- **ضيق الوقت**: لا يجد وقتاً للتسويق رغم أهميته
- **ميزانية محدودة**: لا يستطيع توظيف فريق تسويق كامل
- **نقص الخبرة**: لا يعرف من أين يبدأ في التسويق الرقمي
- **صعوبة القياس**: لا يعرف إذا كانت جهوده التسويقية تعطي نتائج

#### السلوك الشرائي:
- يبحث في Google عن حلول
- يسأل معارفه من رواد الأعمال
- يقرأ تقييمات العملاء بعناية
- يفضل تجربة مجانية قبل الشراء
- يحتاج 2-4 أسابيع لاتخاذ قرار الشراء

#### الاعتراضات:
- "هل سأحتاج وقت طويل لتعلم هذا؟"
- "هل يمكنني إدارته بنفسي أم أحتاج موظف متخصص؟"
- "ماذا لو لم تأتي نتائج سريعة؟"

#### القنوات:
- LinkedIn (للتواصل المهني)
- Twitter (لمتابعة الأخبار)
- مجموعات WhatsApp لرواد الأعمال
- فعاليات الغرف التجارية
- Podcasts عن الأعمال أثناء القيادة

## كيف تجمع البيانات لـ Persona؟

### 1. استبيانات العملاء الحاليين
أسئلة مثل:
- كيف اكتشفت منتجنا؟
- ما المشكلة التي كنت تحاول حلها؟
- ما الذي كاد أن يمنعك من الشراء؟
- كيف تصف منتجنا لصديق؟

### 2. مقابلات معمقة
احجز 30 دقيقة مع 5-10 عملاء واسألهم عن:
- يومهم النموذجي
- تحدياتهم الرئيسية
- كيف يتخذون قرارات الشراء
- ما الذي يجعل منتجاً ما مثالياً لهم

### 3. تحليل البيانات
- Google Analytics: من يزور موقعك؟
- Facebook/Instagram Insights: من يتفاعل مع محتواك؟
- CRM: أنماط في العملاء الذين يشترون أكثر

### 4. مراقبة وسائل التواصل
- ماذا يقول الناس عن منتجك ومنتجات المنافسين؟
- ما الأسئلة الشائعة؟
- ما الشكاوى المتكررة؟

## استخدام Buyer Persona

بمجرد إنشائها، استخدمها في:

### التسويق:
- كتابة إعلانات تتحدث مباشرة لآلامهم
- إنشاء محتوى يجيب على أسئلتهم
- اختيار القنوات التي يتواجدون فيها

### تطوير المنتج:
- بناء مميزات تحل مشاكلهم الحقيقية
- تحديد أولويات التطوير

### المبيعات:
- معرفة ماذا تقول في أول اتصال
- فهم الاعتراضات قبل أن تُقال
- تخصيص العرض لكل نوع من العملاء

### خدمة العملاء:
- توقع المشاكل قبل حدوثها
- توفير الدعم بالطريقة التي يفضلونها

## أخطاء شائعة في بناء Personas

### 1. الاعتماد على الافتراضات فقط
لا تخمن - ابحث! تحدث مع عملاء حقيقيين.

### 2. جعلها عامة جداً
"الجميع" ليس persona. كن محدداً.

### 3. إنشاء الكثير منها
ابدأ بـ 2-3 personas رئيسية، ليس 10.

### 4. عدم تحديثها
Personas تتغير مع الوقت. راجعها كل 6-12 شهر.

### 5. عدم استخدامها
الهدف من بنائها هو استخدامها في كل قرار تسويقي!

## التطبيق العملي

استخدم أداة **منشئ شخصية العميل المثالي** أدناه لبناء أول Buyer Persona لمشروعك.

## الخلاصة

> "لا تحاول أن ترضي الجميع، بل ارضِ شخصاً واحداً تماماً"

عندما تعرف عميلك المثالي بدقة، ستستطيع:
- كتابة رسائل تلامس قلبه مباشرة
- إنشاء منتج يحل مشكلته الحقيقية
- التواصل معه في الأماكن الصحيحة
- بناء علاقة طويلة الأمد

في الدرس القادم، سنتعمق في رحلة هذا العميل من أول لحظة وعي حتى الشراء والولاء.

---

### الواجب
1. استخدم أداة بناء Persona لإنشاء شخصية واحدة على الأقل
2. قم بمقابلة 3 عملاء حاليين أو محتملين للتحقق من افتراضاتك
3. احفظ Persona في مكان يمكن لفريقك الوصول إليه
CONTENT;
    }
}
