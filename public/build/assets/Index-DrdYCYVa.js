import{r as u,D as K,o as O,c as n,e,j as E,k as M,v as W,F,x as N,g as X,t as r,E as S,A as C,d as i,n as Y}from"./app-E0SyKMCT.js";const Z={class:"space-y-6"},ee={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},te={class:"relative max-w-md w-full sm:w-auto"},se={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},oe={class:"overflow-x-auto"},re={class:"min-w-full divide-y divide-gray-200"},ae={class:"bg-white divide-y divide-gray-200"},le={class:"px-6 py-4 whitespace-nowrap"},ne={class:"flex items-center"},ie={class:"flex-shrink-0 h-10 w-10"},de=["src"],ue={key:1,class:"h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center text-primary-600 font-bold"},ce={class:"mr-4"},pe={class:"text-sm font-medium text-gray-900"},me={class:"text-sm text-gray-500"},ge={class:"px-6 py-4 whitespace-nowrap"},xe={class:"px-6 py-4 whitespace-nowrap"},ve={class:"text-sm text-gray-900"},fe={class:"px-6 py-4 whitespace-nowrap"},ye={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},be={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={class:"px-6 py-4 whitespace-nowrap text-left text-sm font-medium"},_e={class:"flex items-center justify-end gap-2"},ke=["onClick"],Ce=["onClick"],je=["onClick"],Ae={key:2},Ee={key:0,class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between"},Me=["disabled"],De={class:"text-sm text-gray-700"},Ue=["disabled"],Be={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},$e={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Te={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",dir:"rtl"},ze={class:"sm:flex sm:items-start"},Re={class:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right w-full"},Le={class:"mt-2 text-sm text-gray-500"},Ve={class:"mt-6 space-y-4"},Fe={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},Ne=["disabled"],Se={class:"mt-8 p-4 bg-gray-900 text-green-400 rounded-lg text-xs font-mono",dir:"ltr"},He={__name:"Index",setup(Ie){const d=u([]),v=u(!0),_=u(""),c=u(1),x=u(1),f=u(null),j=u(!1),g=u(null),k=u(!1),p=K({role:"user",subscription_tier:"free"}),y=async()=>{var o,t,b,h,s,w,B,$,T,z,R,L,V;v.value=!0;try{const a={page:c.value};_.value&&(a.search=_.value);const l=await C.get("/api/v1/admin/users",{params:a});if(console.log("Full Response:",l),console.log("Response Data:",l.data),console.log("Response Status:",l.status),f.value={success:(o=l.data)==null?void 0:o.success,dataType:typeof((t=l.data)==null?void 0:t.data),isArray:Array.isArray((b=l.data)==null?void 0:b.data),hasNestedData:!!((s=(h=l.data)==null?void 0:h.data)!=null&&s.data),status:l.status,fullData:l.data},l.data&&l.data.success){const m=l.data.data;m&&m.data&&Array.isArray(m.data)?(d.value=m.data,x.value=m.last_page||1):Array.isArray(m)?(d.value=m,x.value=1):(d.value=[],f.value.error="Unrecognized structure",console.error("Unexpected data structure:",m))}else d.value=[],f.value.error=((w=l.data)==null?void 0:w.message)||"No success flag"}catch(a){console.error("Error fetching users:",a),console.error("Error response:",a.response),f.value={error:a.message,status:(B=a.response)==null?void 0:B.status,statusText:($=a.response)==null?void 0:$.statusText,responseData:(T=a.response)==null?void 0:T.data,isAuthError:((z=a.response)==null?void 0:z.status)===401||((R=a.response)==null?void 0:R.status)===403},d.value=[],((L=a.response)==null?void 0:L.status)===401?alert("جلسة العمل منتهية. يرجى تسجيل الدخول مرة أخرى."):((V=a.response)==null?void 0:V.status)===403&&alert("ليس لديك صلاحية الوصول لهذه الصفحة.")}finally{v.value=!1}};let D=null;const I=()=>{clearTimeout(D),D=setTimeout(()=>{c.value=1,y()},300)},U=o=>{o>=1&&o<=x.value&&(c.value=o,y())},P=o=>({admin:"مسؤول",user:"مستخدم",advertiser:"معلن"})[o]||o,H=o=>({free:"مجاني",basic:"أعمال",pro:"احترافي",enterprise:"مؤسسات"})[o]||o,G=async o=>{if(confirm(`هل أنت متأكد من إيقاف حساب ${o.name}؟`))try{await C.post(`/api/v1/admin/users/${o.id}/suspend`),y()}catch(t){console.error("Error suspending user:",t)}},Q=async o=>{try{await C.post(`/api/v1/admin/users/${o.id}/activate`),y()}catch(t){console.error("Error activating user:",t)}},q=o=>{g.value=o,p.role=o.role,p.subscription_tier=o.subscription_tier,j.value=!0},A=()=>{j.value=!1,g.value=null},J=async()=>{if(g.value){k.value=!0;try{await C.put(`/api/v1/admin/users/${g.value.id}`,p);const o=d.value.findIndex(t=>t.id===g.value.id);o!==-1&&(d.value[o]={...d.value[o],...p}),A(),alert("تم تحديث بيانات المستخدم بنجاح")}catch(o){console.error("Error updating user:",o),alert("حدث خطأ أثناء التحديث")}finally{k.value=!1}}};return O(()=>{y()}),(o,t)=>{var b,h;return i(),n("div",Z,[e("div",ee,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"إدارة المستخدمين"),e("p",{class:"text-sm text-gray-500 mt-1"},"عرض وإدارة جميع المستخدمين في المنصة")],-1)),e("div",te,[M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),onInput:I,type:"text",placeholder:"بحث في المستخدمين...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"},null,544),[[W,_.value]]),t[5]||(t[5]=e("span",{class:"absolute left-3 top-2.5 text-gray-400"},[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",se,[e("div",oe,[e("table",re,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"المستخدم"),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"الدور"),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"الاشتراك"),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"الحالة"),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"تاريخ الانضمام"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"إجراءات")])],-1)),e("tbody",ae,[v.value?(i(),n(F,{key:0},N(5,s=>e("tr",{key:s},[...t[7]||(t[7]=[e("td",{colspan:"6",class:"px-6 py-4 text-center"},[e("div",{class:"h-4 bg-gray-100 rounded animate-pulse w-3/4 mx-auto"})],-1)])])),64)):(i(!0),n(F,{key:1},N(d.value,s=>(i(),n("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[e("td",le,[e("div",ne,[e("div",ie,[s.avatar_url?(i(),n("img",{key:0,src:s.avatar_url,class:"h-10 w-10 rounded-full object-cover"},null,8,de)):(i(),n("div",ue,r(s.name.charAt(0)),1))]),e("div",ce,[e("div",pe,r(s.name),1),e("div",me,r(s.email),1)])])]),e("td",ge,[e("span",{class:Y([{"bg-purple-100 text-purple-800":s.role==="admin","bg-blue-100 text-blue-800":s.role==="advertiser","bg-gray-100 text-gray-800":s.role==="user"},"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},r(P(s.role)),3)]),e("td",xe,[e("span",ve,r(H(s.subscription_tier)),1)]),e("td",fe,[s.is_active!==!1?(i(),n("span",ye," نشط ")):(i(),n("span",be," موقوف "))]),e("td",he,r(new Date(s.created_at).toLocaleDateString("ar-EG")),1),e("td",we,[e("div",_e,[e("button",{onClick:w=>q(s),class:"text-indigo-600 hover:text-indigo-900 bg-indigo-50 p-2 rounded-lg hover:bg-indigo-100 transition-colors",title:"تعديل"},[...t[8]||(t[8]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ke),s.is_active!==!1?(i(),n("button",{key:0,onClick:w=>G(s),class:"text-red-600 hover:text-red-900 bg-red-50 p-2 rounded-lg hover:bg-red-100 transition-colors",title:"إيقاف الحساب"},[...t[9]||(t[9]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})],-1)])],8,Ce)):(i(),n("button",{key:1,onClick:w=>Q(s),class:"text-green-600 hover:text-green-900 bg-green-50 p-2 rounded-lg hover:bg-green-100 transition-colors",title:"تفعيل الحساب"},[...t[10]||(t[10]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,je))])])]))),128)),!v.value&&d.value.length===0?(i(),n("tr",Ae,[...t[11]||(t[11]=[e("td",{colspan:"6",class:"px-6 py-12 text-center text-gray-500"},[e("svg",{class:"w-12 h-12 mx-auto text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})]),X(" لا يوجد مستخدمين مطابقين للبحث ")],-1)])])):E("",!0)])])]),x.value>1?(i(),n("div",Ee,[e("button",{onClick:t[1]||(t[1]=s=>U(c.value-1)),disabled:c.value===1,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," السابق ",8,Me),e("span",De," صفحة "+r(c.value)+" من "+r(x.value),1),e("button",{onClick:t[2]||(t[2]=s=>U(c.value+1)),disabled:c.value===x.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," التالي ",8,Ue)])):E("",!0)]),j.value?(i(),n("div",Be,[e("div",$e,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:A}),t[18]||(t[18]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Te,[e("div",ze,[e("div",Re,[t[17]||(t[17]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," تعديل بيانات المستخدم ",-1)),e("div",Le,r((b=g.value)==null?void 0:b.name)+" ("+r((h=g.value)==null?void 0:h.email)+") ",1),e("div",Ve,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"الدور (Role)",-1)),M(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>p.role=s),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[...t[13]||(t[13]=[e("option",{value:"user"},"مستخدم (User)",-1),e("option",{value:"admin"},"مسؤول (Admin)",-1),e("option",{value:"advertiser"},"معلن (Advertiser)",-1)])],512),[[S,p.role]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"باقة الاشتراك",-1)),M(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>p.subscription_tier=s),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[...t[15]||(t[15]=[e("option",{value:"free"},"مجاني (Free)",-1),e("option",{value:"basic"},"أعمال (Basic)",-1),e("option",{value:"pro"},"احترافي (Pro)",-1),e("option",{value:"enterprise"},"مؤسسات (Enterprise)",-1)])],512),[[S,p.subscription_tier]])])])])]),e("div",Fe,[e("button",{onClick:J,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",disabled:k.value},r(k.value?"جاري الحفظ...":"حفظ التغييرات"),9,Ne),e("button",{onClick:A,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm"}," إلغاء ")])])])])):E("",!0),e("div",Se,[t[19]||(t[19]=e("p",null,[e("strong",null,"Debug Info:")],-1)),e("p",null,"Users Count: "+r(d.value.length),1),e("p",null,"Loading: "+r(v.value),1),e("p",null,"Raw Response Data: "+r(f.value),1)])])}}};export{He as default};
